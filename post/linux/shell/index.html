<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Shell一些tips - HLDay</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="hlday" /><meta name="description" content="使用shell过程中的一些tips" /><meta name="keywords" content="hlday, blog, go, python, linux, shell" />





<script async src="https://www.googletagmanager.com/gtag/js?id=G-59Y2CYW544"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-59Y2CYW544');
</script>

<meta name="generator" content="Hugo 0.93.2 with theme even" />


<link rel="canonical" href="/post/linux/shell/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">



<meta property="og:title" content="Shell一些tips" />
<meta property="og:description" content="使用shell过程中的一些tips" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/linux/shell/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-01-10T15:38:00+08:00" />
<meta property="article:modified_time" content="2023-01-10T15:38:00+08:00" />

<meta itemprop="name" content="Shell一些tips">
<meta itemprop="description" content="使用shell过程中的一些tips"><meta itemprop="datePublished" content="2023-01-10T15:38:00+08:00" />
<meta itemprop="dateModified" content="2023-01-10T15:38:00+08:00" />
<meta itemprop="wordCount" content="1058">
<meta itemprop="keywords" content="linux," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Shell一些tips"/>
<meta name="twitter:description" content="使用shell过程中的一些tips"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">HLDay</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/image/bing">
        <li class="mobile-menu-item">BingDailyPicture</li>
      </a><a href="/post/preview/">
        <li class="mobile-menu-item">Share</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel" style="max-width: 75%; width: 70% !important;">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">HLDay</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/image/bing">BingDailyPicture</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/preview/">Share</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Shell一些tips</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-01-10 </span>
        <div class="post-category">
            <a href="/categories/linux/"> linux </a>
            </div>
          <span class="more-meta"> 1058 words </span>
          <span class="more-meta"> 3 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc" style="position: fixed !important;width:14%;top:10%;right: 1% !important;">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#shell">shell</a>
      <ul>
        <li><a href="#数字大小比较">数字大小比较</a>
          <ul>
            <li><a href="#整数比较">整数比较</a></li>
            <li><a href="#小数与整数之间的比较">小数与整数之间的比较</a></li>
          </ul>
        </li>
        <li><a href="#字符串比较">字符串比较</a></li>
        <li><a href="#在文件指定行后面加一列">在文件指定行后面加一列</a></li>
        <li><a href="#grep-反向过滤">grep 反向过滤</a></li>
        <li><a href="#去除字符串的前后空格">去除字符串的前后空格</a></li>
        <li><a href="#vim中文乱码">vim中文乱码</a></li>
        <li><a href="#使用指令修复json">使用指令修复json</a></li>
        <li><a href="#生成随机字符串">生成随机字符串</a></li>
        <li><a href="#查看操作系统信息">查看操作系统信息</a></li>
        <li><a href="#crontab日志">crontab日志</a></li>
      </ul>
    </li>
    <li><a href="#ansible">ansible</a>
      <ul>
        <li><a href="#ansible取其他主机的变量">ansible取其他主机的变量</a></li>
        <li><a href="#ansible按照shell结果选择执行分支">ansible按照shell结果选择执行分支</a></li>
      </ul>
    </li>
    <li><a href="#git">git</a>
      <ul>
        <li><a href="#删除远程仓库文件不删除本地文件">删除远程仓库文件，不删除本地文件</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="shell">shell</h1>
<h2 id="数字大小比较">数字大小比较</h2>
<h3 id="整数比较">整数比较</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">if</span> <span class="o">[</span> <span class="nv">$1</span> -gt <span class="nv">$2</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span> 
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;参数</span><span class="nv">$1</span><span class="s2">大于参数</span><span class="nv">$2</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span> 
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;参数</span><span class="nv">$1</span><span class="s2">小于参数</span><span class="nv">$2</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>数字判断一些命令：</p>
<ul>
<li>-gt：大于</li>
<li>-lt：小于</li>
<li>-eq：等于</li>
<li>-ne：不等于</li>
<li>-ge：大于等于</li>
<li>-le：小于等于</li>
</ul>
<h3 id="小数与整数之间的比较">小数与整数之间的比较</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">a</span><span class="o">=</span>1.6
</span></span><span class="line"><span class="cl"><span class="nv">b</span><span class="o">=</span>6.1
</span></span><span class="line"><span class="cl"><span class="nv">c</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$a</span><span class="s2"> &gt; </span><span class="nv">$b</span><span class="s2">&#34;</span> <span class="p">|</span> bc<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 如果双引号内执行结果为真，c的值就是1，否则c的值就是0.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以使用的比较符号：</p>
<blockquote>
<p>&lt; &gt; == &gt;= &lt;=</p>
</blockquote>
<h2 id="字符串比较">字符串比较</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">a</span><span class="o">=</span><span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">b</span><span class="o">=</span><span class="s2">&#34;2&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34;</span><span class="nv">$a</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="nv">$b</span><span class="s2">&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Strings are equal.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Strings are not equal.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">[[</span> <span class="s2">&#34;string1&#34;</span> <span class="o">==</span> <span class="s2">&#34;string2&#34;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;Equal&#34;</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">&#34;Not equal&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 判断字符串是否为空</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> -z <span class="nv">$a</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;String is empty.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 正则表达式</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="nv">$a</span> <span class="o">=</span>~ .*Linux.* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;It&#39;s there.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 匹配*</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="nv">$a</span> <span class="o">==</span> *<span class="s2">&#34;Linux&#34;</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;It&#39;s there.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="在文件指定行后面加一列">在文件指定行后面加一列</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 例如需要在.ansible.cfg中添加deprecation_warnings = False的配置</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/.ansible.cfg&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">  cp <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/.ansible.cfg&#34;</span> <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/.ansible.cfg.bak&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">set</span> +e <span class="c1"># why：grep 没有的时候，返回码不是0，需要忽略这个错误</span>
</span></span><span class="line"><span class="cl">  <span class="nv">deprecation_warnings</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/.ansible.cfg&#34;</span><span class="p">|</span>grep <span class="s2">&#34;deprecation_warnings = False&#34;</span><span class="p">|</span>wc -l<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">set</span> -e
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span>  <span class="nv">$deprecation_warnings</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    sed -i <span class="s1">&#39;/defaults]/a\\deprecation_warnings = False&#39;</span> <span class="nv">$HOME</span>/.ansible.cfg
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="grep-反向过滤">grep 反向过滤</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 过滤掉包含abc的行</span>
</span></span><span class="line"><span class="cl">cat a.log<span class="p">|</span>grep -v <span class="s2">&#34;abc&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="去除字符串的前后空格">去除字符串的前后空格</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34; A B C &#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1=$1&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 这个方法是0的时候，就没有输出，要注意</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39; A B C &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{sub(/^ */, &#34;&#34;);sub(/ *$/, &#34;&#34;)}1&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39; A B C &#39;</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/^[ ]*//g&#39;</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/[ ]*$//g&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">eval</span> <span class="nb">echo</span> <span class="s2">&#34; A B C &#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>为什么<code>'$1=$1'</code>有问题<a href="https://www.gnu.org/software/gawk/manual/html_node/Changing-Fields.html">Changing Fields (The GNU Awk User’s Guide)</a><a href="https://www.gnu.org/software/gawk/manual/html_node/Assignment-Ops.html">Assignment Ops (The GNU Awk User’s Guide)</a><a href="https://unix.stackexchange.com/questions/577726/why-does-awk-behave-differently-for-1-if-the-value-is-0-number-zero">Why does awk behave differently for $1 if the value is 0 (number zero)? - Unix &amp; Linux Stack Exchange</a></p>
<p>将<code>$1</code>赋值给<code>$1</code>的时候，awk会通过将通过默认OFS（默认为空格）连接字符串重新计算<code>$0</code></p>
<p><code>'$1=$1'</code>是一个赋值操作，如果是0的话，这个表达式为false，所以不会执行print</p>
<h2 id="vim中文乱码">vim中文乱码</h2>
<p>将下述内容放到<code>$HOME/.vimrc</code>中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">syntax on
</span></span><span class="line"><span class="cl"><span class="nb">set</span> <span class="nv">fileencodings</span><span class="o">=</span>utf-8,gb2312,gb18030,gbk,ucs-bom,cp936,latin1
</span></span><span class="line"><span class="cl"><span class="nb">set</span> <span class="nv">enc</span><span class="o">=</span>utf8
</span></span><span class="line"><span class="cl"><span class="nb">set</span> <span class="nv">fencs</span><span class="o">=</span>utf8,gbk,gb2312,gb18030
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="使用指令修复json">使用指令修复json</h2>
<p>如果json因为修改失败，多了逗号，可以使用如下指令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yq <span class="nb">eval</span> -o json test.json <span class="p">|</span>tee test.json
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="生成随机字符串">生成随机字符串</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">head -c <span class="m">32</span> /dev/random <span class="p">|</span> base64 <span class="c1"># 会阻塞</span>
</span></span><span class="line"><span class="cl">head -c <span class="m">32</span> /dev/urandom <span class="p">|</span> base64 <span class="c1"># 不会阻塞</span>
</span></span><span class="line"><span class="cl">openssl rand -hex <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$RANDOM</span> <span class="c1"># 得到的这个随机数是介于 0~32767 之间的一个整数</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="查看操作系统信息">查看操作系统信息</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">uname -a
</span></span><span class="line"><span class="cl">cat /etc/os-release
</span></span><span class="line"><span class="cl">cat /proc/cpuinfo <span class="c1">#cup信息</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="crontab日志">crontab日志</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo tail -f -n 200 /var/log/syslog|grep CRON
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="ansible">ansible</h1>
<h2 id="ansible取其他主机的变量">ansible取其他主机的变量</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 使用ansible中的A主机的B变量，通常用于目标主机并不存在于A的hosts中的情况</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;{{hostvars[groups[&#39;A&#39;][0]][&#39;B&#39;]}}&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ansible按照shell结果选择执行分支">ansible按照shell结果选择执行分支</h2>
<p>使用<code>command</code>将结果注册为变量，判断变量的状态<a href="https://docs.ansible.com/ansible/latest/reference_appendices/common_return_values.html">Return Values — Ansible Documentation</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">exec</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l">A</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Ensure a exit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">curl http://{{inventory_hostname}}:8080/healthz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l">healthz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">exec run</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">        </span><span class="w">        </span><span class="l">docker run</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l">healthz.rc != 0</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="git">git</h1>
<h2 id="删除远程仓库文件不删除本地文件">删除远程仓库文件，不删除本地文件</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git rm -r --cached 文件/文件夹名称
</span></span><span class="line"><span class="cl">git commit -m &#34;提交说明&#34;
</span></span><span class="line"><span class="cl">git push origin master
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">hlday</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2023-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/golang/monitor_download_progress/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">GO使用io.TeeReader显示下载进度</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/linux/ubuntu_smartdns_v2ray/">
            <span class="next-text nav-default">在Ubuntu上安装v2ray和smartdns，并在客户端使用proxy上网</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="hTangle/hxsup-blog-image"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <style>
      utterances {
        max-width: 75%;
        width: 1200px;
      }
    </style>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <link href="https://cdn.staticfile.org/bootstrap/5.0.2/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdn.staticfile.org/bootstrap/5.0.2/js/bootstrap.min.js" crossorigin="anonymous"></script>
<style>
  .modal {
    display: none;
     
    position: fixed;
     
    z-index: 1000;
     
    padding-top: 100px;
     
    left: 0;
    top: 0;
    width: 100%;
     
    height: 100%;
     
    overflow: auto;
     
    background-color: #FFFFFF;
     
    background-color: rgba(255, 255,255, 0.98);
     
  }

   
  .modal-content {
    margin: auto;
    display: block;
  }

   
  .modal-content,
  #caption {
    animation-name: zoom;
    animation-duration: 0.6s;
  }

  @keyframes zoom {
    from {
      transform: scale(0)
    }

    to {
      transform: scale(1)
    }
  }
  .image-show-center {
    display: block !important;
    margin: 0 auto;
    border: 0;
    border-radius: 5px;
     
  }
</style>
<div id="myModal" class="modal" onclick="disShowImage()">
  <img class="modal-content" id="img01" onmousewheel="return zoomImg(this)"
       style="width: auto;height: auto;max-width: 100%;max-height: 100%;">
</div>
<script type="text/javascript">
  var modal = document.getElementById("myModal");
  var modalImg = document.getElementById("img01");
  
  function disShowImage() {
    modal.style.display = "none";
  }
  function zoomImg(obj) {
    
    let zoom = parseInt(obj.style.zoom, 10) || 100;
    
    zoom += event.wheelDelta / 12;
    if (zoom > 0) {
      obj.style.zoom = zoom + '%';
    }
    return false;
  }
  $(function () {
    console.log("init")
    var imgs=$("img");
    for(var i=0;i<imgs.length;i++){
      imgs[i].className="image-show-center rounded";
    }
    
    $("img").on('click', function () {
      console.log("test---", $(this).attr("src"))
      modal.style.display = "block";
      modalImg.style.zoom = "reset";
      modalImg.src = $(this).attr("src");
      imageClicked = true;
    })
    
  })
</script>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="hsup1994@hotmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/hTangle" class="iconfont icon-github" title="github"></a>
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2022 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span><a href="/">hlday</a></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  



<script type="text/javascript" src="/js/main.min.bfb94e1fe4773651a6fe907d388ed08d7d6f9628a062d0740d992e1dfb49466e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
